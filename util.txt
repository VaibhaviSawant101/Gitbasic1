This is the utility function of the third file version